<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Elm Yahtzee</title>
    <link href="https://fonts.googleapis.com/css?family=Kalam" rel="stylesheet">
    <link rel="icon" href="favicon.ico">
    <link href="main.css" rel="stylesheet">
    <script src="main.js"></script>
</head>
<body>
<div id="elm"></div>
<script>
    var app = undefined;
    try {
        app = Elm.Main.init({
            node: document.getElementById('elm'),
            flags: {
                gameState: JSON.parse(sessionStorage.getItem('gameState'))
            }
        });
    } catch (error) {
        console.error(error);
        app = Elm.Main.init({
            node: document.getElementById('elm'),
            flags: null
        });
    }
    app.ports.persistGameState.subscribe(function(data) {
        sessionStorage.setItem('gameState', JSON.stringify(data));
    });
    app.ports.persistCompletedGame.subscribe(function(data) {
        try {
            var gameHistoryJson = localStorage.getItem('history');
            var gameHistory = gameHistoryJson ? JSON.parse(gameHistoryJson) : [];
            gameHistory.push(data);
            localStorage.setItem('history', JSON.stringify(gameHistory));
        } catch (error) {
            console.error(error);
        }
    });
</script>
</body>
</html>